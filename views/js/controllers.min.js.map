{"version":3,"file":"routes.js","sources":["routes.js","history/line!tpl","history/index.js"],"names":[],"mappings":"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","sourcesContent":["define('taoRevision/controller/routes',[],function(){\n    return {\n        'History' : {\n            'actions' : {\n                'index' : 'controller/history/index',\n            }\n        }\n    };\n});\n\n","\ndefine('tpl!taoRevision/controller/history/line', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing;\n\n\n  buffer += \"<tr>\\n    <td class=\\\"numeric\\\">\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</td>\\n    <td class=\\\"date\\\">\";\n  if (helper = helpers.modified) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.modified); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</td>\\n    <td class=\\\"user\\\">\";\n  if (helper = helpers.author) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.author); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"</td>\\n    <td class=\\\"message\\\">\";\n  if (helper = helpers.message) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.message); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</td>\\n    <td class=\\\"actions\\\">\\n        <button class=\\\"btn-info small restore_revision\\\" data-revision=\\\"\";\n  if (helper = helpers.id) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.id); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\">\\n            <span class=\\\"icon-undo\\\"></span>\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Restore\", options) : helperMissing.call(depth0, \"__\", \"Restore\", options)))\n    + \"\\n        </button>\\n    </td>\\n</tr>\\n\";\n  return buffer;\n  });\n});\n\n","define('taoRevision/controller/history/index',[\n    'jquery',\n    'i18n',\n    'tpl!taoRevision/controller/history/line',\n    'helpers',\n    'ui/feedback',\n    'select2',\n    'tooltipster'\n    ], function($, __, lineTpl, helpers, feedback){\n        'use strict';\n\n        /**\n         * Restore a revision\n         * @param  {DOM Element} element DOM element that triggered the function\n         */\n        var _restoreRevision = function(element) {\n            var $table = $('#revisions-table'),\n                body = $table.find('tbody')[0];\n\n            //Get the revision id\n            var $this = $(element),\n                revision = $this.data('revision');\n            var id = $('#resource_id').val();\n\n            var message = prompt(\"Please enter a message\", __(\"Restored version %s\", revision));\n\n            if( typeof revision !== \"undefined\" &&\n                typeof message !== \"undefined\" &&\n                message != null &&\n                revision !== \"\" &&\n                message !== \"\"){\n                $.post(\n                    helpers._url('restoreRevision', 'History', 'taoRevision'),\n                    {id : id, revisionId : revision, message : message})\n                    .done(function(res){\n                        if(res && res.success){\n                            feedback().success(__(\"Resource restored\"));\n                            $(body).append(lineTpl(res));\n                            $('.tree').trigger('refresh.taotree'); \n                        } else {\n                            feedback().error(__(\"Something went wrong...\"));\n                        }\n                    })\n            }\n        };\n\n        var mainCtrl = {\n            'start' : function(){\n\n                var $container = $('.revision-container'),\n                    $form      = $('form', $container),\n                    $submiter  = $(':submit', $form);\n\n                var $table = $('#revisions-table'),\n                    body = $table.find('tbody')[0];\n\n                $form.on('submit', function(e){\n                    e.preventDefault();\n                    e.stopImmediatePropagation();\n                });\n                $submiter.on('click', function(e){\n                    e.preventDefault();\n\n                var $message = $('#message',$form);\n                if($message.val() != \"\"){\n                    $submiter.addClass('disabled');\n                    $.post($form.attr('action'), $form.serialize())\n                        .done(function(res){\n                            if(res && res.success){\n                                feedback().success(__(\"Resource committed\"));\n                                $(body).append(lineTpl(res));\n\n\n                            } else {\n                                feedback().error(__(\"Something went wrong...\"));\n                            }\n                        })\n                        .complete(function(){\n                            $submiter.removeClass('disabled');\n                            $message.val('');\n                        });\n                }\n                else{\n                    feedback().error(__(\"Please give a message to your commit\"));\n                }\n                });\n\n\n                $table.on('click', '.restore_revision', function(event) {\n                    event.preventDefault();\n                    _restoreRevision(this);\n                });\n            }\n        };\n\n        return mainCtrl;\n    })\n;\n"]}